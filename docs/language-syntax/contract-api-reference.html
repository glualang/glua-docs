<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>glua language</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="typed lua">
    <link rel="preload" href="/glua-docs/assets/css/0.styles.25c3ab7b.css" as="style"><link rel="preload" href="/glua-docs/assets/js/app.186231c2.js" as="script"><link rel="preload" href="/glua-docs/assets/js/2.9eb1a6e4.js" as="script"><link rel="preload" href="/glua-docs/assets/js/25.0601325e.js" as="script"><link rel="prefetch" href="/glua-docs/assets/js/10.f05dc39c.js"><link rel="prefetch" href="/glua-docs/assets/js/11.99d5e97c.js"><link rel="prefetch" href="/glua-docs/assets/js/12.03b30a3a.js"><link rel="prefetch" href="/glua-docs/assets/js/13.5400b376.js"><link rel="prefetch" href="/glua-docs/assets/js/14.74e35c2b.js"><link rel="prefetch" href="/glua-docs/assets/js/15.c9ccd152.js"><link rel="prefetch" href="/glua-docs/assets/js/16.2b65b131.js"><link rel="prefetch" href="/glua-docs/assets/js/17.d05ab6a2.js"><link rel="prefetch" href="/glua-docs/assets/js/18.0d175746.js"><link rel="prefetch" href="/glua-docs/assets/js/19.e7c27497.js"><link rel="prefetch" href="/glua-docs/assets/js/20.627dadda.js"><link rel="prefetch" href="/glua-docs/assets/js/21.e0dc6dcb.js"><link rel="prefetch" href="/glua-docs/assets/js/22.5ed2fecc.js"><link rel="prefetch" href="/glua-docs/assets/js/23.e8fc321e.js"><link rel="prefetch" href="/glua-docs/assets/js/24.0129229b.js"><link rel="prefetch" href="/glua-docs/assets/js/26.4e5ca449.js"><link rel="prefetch" href="/glua-docs/assets/js/27.62f687ef.js"><link rel="prefetch" href="/glua-docs/assets/js/28.89055e5b.js"><link rel="prefetch" href="/glua-docs/assets/js/29.8ce383cb.js"><link rel="prefetch" href="/glua-docs/assets/js/3.19c38f7a.js"><link rel="prefetch" href="/glua-docs/assets/js/30.3ca98452.js"><link rel="prefetch" href="/glua-docs/assets/js/31.3e5d5d8f.js"><link rel="prefetch" href="/glua-docs/assets/js/32.9b6a8dc3.js"><link rel="prefetch" href="/glua-docs/assets/js/33.f1d52084.js"><link rel="prefetch" href="/glua-docs/assets/js/34.7916f2f8.js"><link rel="prefetch" href="/glua-docs/assets/js/35.225d6a41.js"><link rel="prefetch" href="/glua-docs/assets/js/36.59997d7e.js"><link rel="prefetch" href="/glua-docs/assets/js/37.c2c188b6.js"><link rel="prefetch" href="/glua-docs/assets/js/38.47a782a0.js"><link rel="prefetch" href="/glua-docs/assets/js/39.533b18ad.js"><link rel="prefetch" href="/glua-docs/assets/js/4.05e90b9e.js"><link rel="prefetch" href="/glua-docs/assets/js/40.ea73c31f.js"><link rel="prefetch" href="/glua-docs/assets/js/41.776b0de9.js"><link rel="prefetch" href="/glua-docs/assets/js/42.8e6b5eb8.js"><link rel="prefetch" href="/glua-docs/assets/js/43.1c3a906b.js"><link rel="prefetch" href="/glua-docs/assets/js/44.3038db04.js"><link rel="prefetch" href="/glua-docs/assets/js/45.2e6ebd85.js"><link rel="prefetch" href="/glua-docs/assets/js/46.f3cb5875.js"><link rel="prefetch" href="/glua-docs/assets/js/47.aa10780d.js"><link rel="prefetch" href="/glua-docs/assets/js/48.34157557.js"><link rel="prefetch" href="/glua-docs/assets/js/49.190a6de3.js"><link rel="prefetch" href="/glua-docs/assets/js/5.9f0ea552.js"><link rel="prefetch" href="/glua-docs/assets/js/50.085a4ae1.js"><link rel="prefetch" href="/glua-docs/assets/js/51.7024e396.js"><link rel="prefetch" href="/glua-docs/assets/js/52.8079233a.js"><link rel="prefetch" href="/glua-docs/assets/js/53.b6936958.js"><link rel="prefetch" href="/glua-docs/assets/js/54.209f6480.js"><link rel="prefetch" href="/glua-docs/assets/js/55.b9f8edb3.js"><link rel="prefetch" href="/glua-docs/assets/js/56.b8bace96.js"><link rel="prefetch" href="/glua-docs/assets/js/57.3456873f.js"><link rel="prefetch" href="/glua-docs/assets/js/58.487779be.js"><link rel="prefetch" href="/glua-docs/assets/js/59.22e902dd.js"><link rel="prefetch" href="/glua-docs/assets/js/6.ff81bb27.js"><link rel="prefetch" href="/glua-docs/assets/js/60.498aaba1.js"><link rel="prefetch" href="/glua-docs/assets/js/61.6a9344ae.js"><link rel="prefetch" href="/glua-docs/assets/js/62.5b40b39b.js"><link rel="prefetch" href="/glua-docs/assets/js/7.de96c27f.js"><link rel="prefetch" href="/glua-docs/assets/js/8.d6461315.js"><link rel="prefetch" href="/glua-docs/assets/js/9.18dead99.js">
    <link rel="stylesheet" href="/glua-docs/assets/css/0.styles.25c3ab7b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/glua-docs/" class="home-link router-link-active"><!----> <span class="site-name">glua language</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="合约api函数"><a href="#合约api函数" class="header-anchor">#</a> 合约API函数</h1> <ul><li><p>使用全局函数transfer_from_contract_to_address可以从当前合约（这个函数调用代码所在的合约）转账一定数额的某种资产给某个地址，第一个参数是目标地址（字符串），第二个参数是资产名称（比如HSR），第三个参数是转账数量的10万倍（int64类型），要求是正数</p> <p>返回值
0   转账成功
-1  未知系统异常
-2  Asset_symbol异常
-3  合约地址非法
-4  目标地址非法
-5  账户余额不足支付转账金额
-6  转账金额为负数</p></li> <li><p>使用全局函数get_contract_balance_amount可以获取某个合约带精度的余额（精度为100000），第一个参数是合约地址（支持查询其他合约的余额），第二个参数是资产名称（比如HSR），返回带精度的合约余额（int64类型），如果出现错误或者合约不存在返回负数</p> <p>返回值
非负数 合约账户余额
-1  资产id异常
-2  合约地址异常</p></li> <li><p>使用全局函数get_chain_now可以获取链上的当前时间，没有参数.</p> <p>返回值
正数  时间戳整数
0     系统异常</p></li> <li><p>使用全局函数get_chain_random可以获取链上的一个伪随机数字，但是同一个此链上的operation操作，不同节点不同时间执行返回结果都一样（实际是取操作发生的块上prev_secret_hash和本交易结合后的哈希）</p> <p>返回值
随机结果</p></li> <li><p>使用全局函数get_header_block_num，可以获取上一个块的块号</p> <p>返回值
当前链最新块的序号</p></li> <li><p>使用全局函数get_waited(num)，表示根据未来块的数据获取伪随机数,num是未来块的块号（但是未来需要再次调用，那个时候第num块已经是过去的块了就能知道结果了）</p> <p>返回值
正整数 结果值
-1  目标块未到
-2  设定的目标块不大于1</p></li> <li><p>使用全局函数get_current_contract_address可以获取这个函数调用出现位置的合约地址，没有参数</p></li> <li><p>全局变量caller存储着调用合约的用户的公钥，全局变量caller_address存储着调用合约的用户的账户地址</p></li> <li><p>在转账到合约发生的时候，如果合约中定义了on_deposit_asset(参数是&quot;资产标识,转账金额&quot;)这个API，那么在转账发生后会调用这个API，并且保证转账和触发此API是原子性的，如果中途出现错误，整体回滚，转账失败。</p></li> <li><p>使用语句emit EventName(arg: string)可以抛出事件，这里emit是关键字，EventName根据需要写入事件名称，由区块链记录下来，其他节点同步到emit触发的event时可以调用本地设置的回调</p></li> <li><p>使用全局函数 is_valid_address(arg: string)可以检查一个地址字符串是否是合法的本区块链地址</p></li> <li><p>使用全局函数 is_valid_contract_address(arg: string)可以检查一个地址字符串是否是合法的合约地址</p></li> <li><p>使用全局函数get_transaction_fee() 可以获取一笔交易的手续费</p> <p>返回值
正整数 结果值
-1  手续费资产id异常
-2  系统异常</p></li> <li><p>使用全局函数get_transaction_id(): string 可以获取本次交易的交易id</p></li> <li><p>使用全局函数transfer_from_contract_to_public_account(to_account_name: string, asset_type: string, amount: int)可以从当前合约中转账到链上的账户名称，返回是否转账的状态</p> <p>返回值
0   转账成功
-1  未知系统异常
-2  Asset_symbol异常
-3  合约地址非法
-4  目标地址非法
-5  账户余额不足支付转账金额
-6  转账金额为负数
-7  不存在指定账户名</p></li> <li><p>import_contract:    (string) =&gt; table   引用合约，参数是合约的名称字符串，返回合约对应的table</p></li> <li><p>import_contract_from_address: (string) =&gt; table  根据合约地址引用合约，返回合约对应的table</p></li> <li><p>get_prev_call_frame_contract_address: () =&gt; string 获取合约调用栈的上一级合约地址（如果上一级合约调用栈不是合约，则返回nil)</p></li> <li><p>get_prev_call_frame_api_name: () =&gt; string 获取合约调用栈的上一级合约API名称（如果上一级合约调用栈不是合约，则返回nil)</p></li> <li><p>get_contract_call_frame_stack_size: () =&gt; int 获取合约调用栈深度</p></li> <li><p>wait_for_future_random: (int) =&gt; int 根据参数的块高度获取根据这个块数据得到的伪随机数，如果这个块高度还没有达到，则返回0</p></li> <li><p>get_system_asset_symbol: () =&gt; string 获取系统基础资产的资产符号</p></li> <li><p>get_system_asset_precision: () =&gt; int 获取系统基础资产的精度，这个值一般是10的若干次方</p></li> <li><p>hex_to_bytes: (string) =&gt; table 把16进制字符串转成字节数组</p></li> <li><p>bytes_to_hex: (table) =&gt; string 把字节数组转成16进制字符串</p></li> <li><p>sha1_hex: (string) =&gt; string 对参数的16进制字符串转换得到的字节数组进行sha1操作然后转成16进制字符串返回</p></li> <li><p>sha3_hex: (string) =&gt; string 对参数的16进制字符串转换得到的字节数组进行sha3-256操作然后转成16进制字符串返回</p></li> <li><p>sha256_hex: (string) =&gt; string 对参数的16进制字符串转换得到的字节数组进行sha256操作然后转成16进制字符串返回</p></li> <li><p>ripemd160_hex: (string) =&gt; string 对参数的16进制字符串转换得到的字节数组进行ripemd160操作然后转成16进制字符串返回</p></li> <li><p>cbor_encode: (object) =&gt; string 把参数按cbor序列化方式序列化成二进制字节数组，并以16进制字符串的形式返回</p></li> <li><p>cbor_decode: (string) =&gt; object 把16进制字符串对应的二进制字节数组按cbor序列化方式来反序列化成uvm对象</p></li> <li><p>signature_recover: (string, string) =&gt; string 从第一个参数的签名（压缩签名格式，65字节，以16进制字符串表示）和第二个参数的原文摘要（32字节，以16进制字符串表示）</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/glua-docs/assets/js/app.186231c2.js" defer></script><script src="/glua-docs/assets/js/2.9eb1a6e4.js" defer></script><script src="/glua-docs/assets/js/25.0601325e.js" defer></script>
  </body>
</html>
