<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>glua language</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="typed lua">
    <link rel="preload" href="/assets/css/0.styles.bca4b9d3.css" as="style"><link rel="preload" href="/assets/js/app.6637f62e.js" as="script"><link rel="preload" href="/assets/js/2.9eb1a6e4.js" as="script"><link rel="preload" href="/assets/js/17.0f34ddb2.js" as="script"><link rel="prefetch" href="/assets/js/10.eaad68b2.js"><link rel="prefetch" href="/assets/js/11.8d379976.js"><link rel="prefetch" href="/assets/js/12.b9d300b8.js"><link rel="prefetch" href="/assets/js/13.02c68d69.js"><link rel="prefetch" href="/assets/js/14.8821dd51.js"><link rel="prefetch" href="/assets/js/15.a5f0838c.js"><link rel="prefetch" href="/assets/js/16.021b97e9.js"><link rel="prefetch" href="/assets/js/18.626a429b.js"><link rel="prefetch" href="/assets/js/19.e7c27497.js"><link rel="prefetch" href="/assets/js/20.627dadda.js"><link rel="prefetch" href="/assets/js/21.f0900fac.js"><link rel="prefetch" href="/assets/js/22.1de422e6.js"><link rel="prefetch" href="/assets/js/23.e8fc321e.js"><link rel="prefetch" href="/assets/js/24.0129229b.js"><link rel="prefetch" href="/assets/js/25.40d785af.js"><link rel="prefetch" href="/assets/js/26.634f09c6.js"><link rel="prefetch" href="/assets/js/27.b69cc2a5.js"><link rel="prefetch" href="/assets/js/28.10e3fb66.js"><link rel="prefetch" href="/assets/js/29.8ce383cb.js"><link rel="prefetch" href="/assets/js/3.19c38f7a.js"><link rel="prefetch" href="/assets/js/30.3ca98452.js"><link rel="prefetch" href="/assets/js/31.3e5d5d8f.js"><link rel="prefetch" href="/assets/js/32.9b6a8dc3.js"><link rel="prefetch" href="/assets/js/33.f1d52084.js"><link rel="prefetch" href="/assets/js/34.2f19e6d1.js"><link rel="prefetch" href="/assets/js/35.8c4ed9ef.js"><link rel="prefetch" href="/assets/js/36.59997d7e.js"><link rel="prefetch" href="/assets/js/37.b7296e39.js"><link rel="prefetch" href="/assets/js/38.2d115ab4.js"><link rel="prefetch" href="/assets/js/39.f8e32322.js"><link rel="prefetch" href="/assets/js/4.05e90b9e.js"><link rel="prefetch" href="/assets/js/40.1c3fee5d.js"><link rel="prefetch" href="/assets/js/41.776b0de9.js"><link rel="prefetch" href="/assets/js/42.8e6b5eb8.js"><link rel="prefetch" href="/assets/js/43.1c3a906b.js"><link rel="prefetch" href="/assets/js/44.3038db04.js"><link rel="prefetch" href="/assets/js/45.2e6ebd85.js"><link rel="prefetch" href="/assets/js/46.f12391d7.js"><link rel="prefetch" href="/assets/js/47.7711ba99.js"><link rel="prefetch" href="/assets/js/48.5a2cf251.js"><link rel="prefetch" href="/assets/js/49.a52140b1.js"><link rel="prefetch" href="/assets/js/5.9f0ea552.js"><link rel="prefetch" href="/assets/js/50.085a4ae1.js"><link rel="prefetch" href="/assets/js/51.7024e396.js"><link rel="prefetch" href="/assets/js/52.8079233a.js"><link rel="prefetch" href="/assets/js/53.2bcd4701.js"><link rel="prefetch" href="/assets/js/54.34384930.js"><link rel="prefetch" href="/assets/js/55.b9f8edb3.js"><link rel="prefetch" href="/assets/js/56.1ad5a641.js"><link rel="prefetch" href="/assets/js/57.3456873f.js"><link rel="prefetch" href="/assets/js/58.487779be.js"><link rel="prefetch" href="/assets/js/59.22e902dd.js"><link rel="prefetch" href="/assets/js/6.d854ea7b.js"><link rel="prefetch" href="/assets/js/60.498aaba1.js"><link rel="prefetch" href="/assets/js/61.6a9344ae.js"><link rel="prefetch" href="/assets/js/62.5b40b39b.js"><link rel="prefetch" href="/assets/js/7.dc69a17e.js"><link rel="prefetch" href="/assets/js/8.2d1b7570.js"><link rel="prefetch" href="/assets/js/9.18dead99.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bca4b9d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">glua language</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="howtos"><a href="#howtos" class="header-anchor">#</a> HOWTOs</h1> <h1 id="_1-怎么进行调试"><a href="#_1-怎么进行调试" class="header-anchor">#</a> 1. 怎么进行调试</h1> <p>默认情况下，合法的合约调用会在代理节点执行，但是普通节点也可以手动打开合约虚拟机，验证区块链中的合约调用，执行合约调用。</p> <p>简单的调试方法可以通过pprint输出变量，对于基本类型pprint会输出多个参数值的字符串表示，
对于函数会输出函数的内存地址，对于table类型的值会转成json字符串输出。</p> <p>之后会增加远程调试功能，在远程代理节点上运行过程中断点调试。</p> <h1 id="_2-怎么使用event"><a href="#_2-怎么使用event" class="header-anchor">#</a> 2. 怎么使用event</h1> <p>合约中可以通过emit EventName(EventArg)抛出，EventName是自定义event名称，
event名称词法要求和变量名要求一样，但是最长支持49字符, EventArg是event的参数，要求值是最长1024字符的字符串</p> <p>调用合约的操作执行过程中抛出的event，会被记录到区块链中，区块链本地节点可以设置监控某合约的某event的回调脚本，
然后在区块链同步到包含被监控的event的块时，会触发设置的脚本，回调脚本也是用uvm编写。</p> <h1 id="_3-常见编译错误有哪些"><a href="#_3-常见编译错误有哪些" class="header-anchor">#</a> 3. 常见编译错误有哪些</h1> <ul><li>变量类型和赋值不一致</li> <li>函数调用的参数类型和实际传参类型不一致</li> <li>函数参数类型和函数体中使用时的类型不一致，建议函数参数加上显式类型声明</li> <li>一些代码块漏加 <code>end</code></li> <li>使用了没有申明过的变量</li> <li>合约中定义了全局变量（合约中不允许定义新的全局变量只能读取，但是脚本中可以定义新全局变量）</li> <li>对nil值进行一些不允许的操作符操作，比如加减乘除等</li> <li>访问非table类型值的属性</li> <li>其他</li></ul> <h1 id="_4-对中文或者其他非英文的支持如何"><a href="#_4-对中文或者其他非英文的支持如何" class="header-anchor">#</a> 4. 对中文或者其他非英文的支持如何</h1> <p>变量名，函数名，event名称不可以使用中文，只能英文字符或者下划线开头，跟着若干个英文字符或者下划线或者数字，
但是字符串中的内容可以用中文或者其他语言的文字，支持unicode。</p> <h1 id="_5-支持多线程吗"><a href="#_5-支持多线程吗" class="header-anchor">#</a> 5. 支持多线程吗</h1> <p>因为uvm主要是为了在区块链的节点上运行的，考虑到区块链上的一些特性尤其是为了达成共识，不支持多线程编程</p> <h1 id="_6-uvm中怎么使用随机数"><a href="#_6-uvm中怎么使用随机数" class="header-anchor">#</a> 6. uvm中怎么使用随机数</h1> <p>提供两种获取随机数的方式</p> <ul><li><p>全局函数get_chain_random()   获取链上伪随机数，这个函数返回的随机数是可被推算出来的结果，仅用于只需要返回均匀分布的数字的地方</p></li> <li><p>全局函数get_waited(blocknumber)  可以获取根据指定块的块号上的二进制内容产生的一个int32数字，参数可以是过去块也可以是未来块的块号要用这种方式获取随机数，可以调用全局函数get_header_block_num()获取到前一个块的块号,
然后用未来的某个块号（当前块号加上未来块的数量，大概10秒一个块）作为参数调用get_waited函数，如果执行的时候当前区块链还没有到这个块号，返回-1，
如果执行的时候当前区块链已经超过了这个块号，返回根据那个块上数据产生的一个int32数字。以彩票为例，设置get_waited的参数为预计开奖时间的未来块号，
然后在开奖前一段时间前允许投注，这时候get_waited参数的块号还没有到这个块，返回类型是-1，所有人都不知道到开奖时间后这个函数调用的返回结果会是多少。
当开始时间到了后，调用get_waited的返回结果固定下来一个int32类型的正数，并且以后任何节点每次用同一个参数调用结果都是固定的，随机数被确定下来了。
可以根据需要用这个返回值 (result % 10000) / 10000 来得到[0, 1)之间的精度4位小数的随机数</p></li></ul> <h1 id="_7-怎么实现面向对象的类型继承和多态"><a href="#_7-怎么实现面向对象的类型继承和多态" class="header-anchor">#</a> 7. 怎么实现面向对象的类型继承和多态</h1> <p>可以使用table类型和record类型模拟对象，record类型有默认属性值，并且属性可以是有默认实现的函数</p> <p>比如</p> <div class="language- extra-class"><pre><code>type Person = {
    id: string default &quot;123&quot;,
    name: string default &quot;uvm&quot;,
    age ?: int = 24,  -- record属性默认值既可以用default也可以用=区分
    fn: (number, number) =&gt; number default 
            function (a: number, b: number) 
                return a + b
            end
}

let p = Person()
pprint(p.id, p.name, p.age)
let n = p.fn(p.age, 2016)
pprint(n)
</code></pre></div><p>如果需要实现类似面向对象语言中的类型继承和多态功能的话，可以实现一个extend函数，调用子record类型的构造函数后，用extend函数
接受子对象和父类型，在extend函数中创建新的父类型的对象，然后给把父类型对象中子类型对象没有的属性赋值给子类型对象。用这种
方法可以起到继承和多态的效果。目前没有给出标准的extend函数，给出一个示例实现</p> <div class="language- extra-class"><pre><code>let function extend(obj, parent_class)
    let parent = parent_class(obj)
    for k, v in pairs(parent) do
        obj[k] = v
    return totable(obj)
end

type A = {
    name1: string,
    age1: int default 100
}

type B = {
    name: string,
    age: int
}

let b = B()
extend(b, A)

-- or

let c = extend(B(), A)
</code></pre></div><p>还有一种实现类型继承和多态的方法是使用setmetatable和元表，这以后会给出更多文档和例子</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6637f62e.js" defer></script><script src="/assets/js/2.9eb1a6e4.js" defer></script><script src="/assets/js/17.0f34ddb2.js" defer></script>
  </body>
</html>
