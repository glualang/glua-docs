<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.bca4b9d3.css" as="style"><link rel="preload" href="/assets/js/app.67072d70.js" as="script"><link rel="preload" href="/assets/js/2.9eb1a6e4.js" as="script"><link rel="preload" href="/assets/js/14.74e35c2b.js" as="script"><link rel="prefetch" href="/assets/js/10.f05dc39c.js"><link rel="prefetch" href="/assets/js/11.8d379976.js"><link rel="prefetch" href="/assets/js/12.b9d300b8.js"><link rel="prefetch" href="/assets/js/13.51490e7f.js"><link rel="prefetch" href="/assets/js/15.2a448532.js"><link rel="prefetch" href="/assets/js/16.021b97e9.js"><link rel="prefetch" href="/assets/js/17.d05ab6a2.js"><link rel="prefetch" href="/assets/js/18.133256ff.js"><link rel="prefetch" href="/assets/js/19.9567cac1.js"><link rel="prefetch" href="/assets/js/20.a7c3bd22.js"><link rel="prefetch" href="/assets/js/21.e0dc6dcb.js"><link rel="prefetch" href="/assets/js/22.437f2e2d.js"><link rel="prefetch" href="/assets/js/23.4a764b30.js"><link rel="prefetch" href="/assets/js/24.386a3fcf.js"><link rel="prefetch" href="/assets/js/25.0601325e.js"><link rel="prefetch" href="/assets/js/26.634f09c6.js"><link rel="prefetch" href="/assets/js/27.ba68acce.js"><link rel="prefetch" href="/assets/js/28.10e3fb66.js"><link rel="prefetch" href="/assets/js/29.ac9594ff.js"><link rel="prefetch" href="/assets/js/3.19c38f7a.js"><link rel="prefetch" href="/assets/js/30.f8ae5e45.js"><link rel="prefetch" href="/assets/js/31.3e5d5d8f.js"><link rel="prefetch" href="/assets/js/32.9b6a8dc3.js"><link rel="prefetch" href="/assets/js/33.f1d52084.js"><link rel="prefetch" href="/assets/js/34.2f19e6d1.js"><link rel="prefetch" href="/assets/js/35.8c4ed9ef.js"><link rel="prefetch" href="/assets/js/36.59997d7e.js"><link rel="prefetch" href="/assets/js/37.b7296e39.js"><link rel="prefetch" href="/assets/js/38.2d115ab4.js"><link rel="prefetch" href="/assets/js/39.533b18ad.js"><link rel="prefetch" href="/assets/js/4.05e90b9e.js"><link rel="prefetch" href="/assets/js/40.ea73c31f.js"><link rel="prefetch" href="/assets/js/41.776b0de9.js"><link rel="prefetch" href="/assets/js/42.8e6b5eb8.js"><link rel="prefetch" href="/assets/js/43.1c3a906b.js"><link rel="prefetch" href="/assets/js/44.3038db04.js"><link rel="prefetch" href="/assets/js/45.2e6ebd85.js"><link rel="prefetch" href="/assets/js/46.f12391d7.js"><link rel="prefetch" href="/assets/js/47.7711ba99.js"><link rel="prefetch" href="/assets/js/48.34157557.js"><link rel="prefetch" href="/assets/js/49.0ebcdc14.js"><link rel="prefetch" href="/assets/js/5.0679a022.js"><link rel="prefetch" href="/assets/js/50.c723146b.js"><link rel="prefetch" href="/assets/js/51.7024e396.js"><link rel="prefetch" href="/assets/js/52.8079233a.js"><link rel="prefetch" href="/assets/js/53.b6936958.js"><link rel="prefetch" href="/assets/js/54.6df0a601.js"><link rel="prefetch" href="/assets/js/55.28e52d4e.js"><link rel="prefetch" href="/assets/js/56.f527b2fa.js"><link rel="prefetch" href="/assets/js/57.3456873f.js"><link rel="prefetch" href="/assets/js/58.487779be.js"><link rel="prefetch" href="/assets/js/59.e402e19a.js"><link rel="prefetch" href="/assets/js/6.8ddfbede.js"><link rel="prefetch" href="/assets/js/60.d1d4181b.js"><link rel="prefetch" href="/assets/js/61.6a9344ae.js"><link rel="prefetch" href="/assets/js/62.5b40b39b.js"><link rel="prefetch" href="/assets/js/7.dc69a17e.js"><link rel="prefetch" href="/assets/js/8.2be40509.js"><link rel="prefetch" href="/assets/js/9.cf73b488.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bca4b9d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="gsharpc支持的c-语法的例子"><a href="#gsharpc支持的c-语法的例子" class="header-anchor">#</a> gsharpc支持的C#语法的例子</h1> <h1 id="c-版合约例子"><a href="#c-版合约例子" class="header-anchor">#</a> C#版合约例子</h1> <div class="language- extra-class"><pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using static UVMCoreLib.UVMCoreFuncs;
using UVMCoreLib;

namespace DemoContract1
{
public class Storage
{
    public string Name { get; set; }
    public int Age { get; set; }
    public string Country; // field test
    public bool IsMale { get; set; }
    public UVMArray&lt;string&gt; ArrayDemo { get; set; }
}

public class MyEventEmitteer : IUVMEventEmitter
{
    public static void EmitHello(string eventArg)
    {
    Console.WriteLine(&quot;event Hello emited, arg is &quot; + eventArg);
    }
    public static void EmitHello2(string eventArg)
    {
    Console.WriteLine(&quot;event Hello2 emited, arg is &quot; + eventArg);
    }
}

public class MyContract : UVMContract&lt;Storage&gt;
{
    public MyContract() : base(new Storage())
    {
    }
    public override void init()
    {
    print(&quot;contract initing&quot;);
    this.storage.Age = 100;
    this.storage.Country = &quot;China&quot;;
    this.storage.Name = &quot;C#&quot;;
    this.storage.IsMale = true;
    this.storage.ArrayDemo = UVMArray&lt;string&gt;.Create();
    this.storage.ArrayDemo.Add(&quot;hello&quot;);
    pprint(this);
    print(&quot;this is contract init api&quot;);
    }
    public string GetAge(string arg)
    {
    print(&quot;this is contract getAge api&quot;);
    return &quot;&quot; + this.storage.Age;
    }
    public string OfflineGetAge(string arg)
    {
    print(&quot;this is contract OfflineGetAge api&quot;);
    print(&quot;age is &quot; + this.storage.Age);
    return &quot;&quot; + this.storage.Age;
    }
    public void TestHello(string arg)
    {
    print(&quot;this is contract hello api with argument &quot; + arg);
    }
}

public class ExampleLibClass
{
    public MyContract Main()
    {
    print(&quot;start of demo C# contract&quot;);              
    var contract = new MyContract();       
    print(&quot;end main&quot;);
    return contract;
    }
}

}
</code></pre></div><h1 id="c-中调用调试合约的例子"><a href="#c-中调用调试合约的例子" class="header-anchor">#</a> C#中调用调试合约的例子</h1> <div class="language- extra-class"><pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GsharpDemo1
{
class Program
{
    static void Main(string[] args)
    {
    var contractEntry = new ExampleLibClass();
    var contract = contractEntry.Main();
    contract.storage = new Storage();
    contract.storage.Age = 25;
    contract.storage.Name = &quot;gsharpc&quot;;
    contract.storage.IsMale = true;
    contract.storage.Country = &quot;China&quot;;
    Console.WriteLine(contract.OfflineGetAge(&quot;hello&quot;));
    }
}
}
</code></pre></div><h1 id="c-版更多语法的例子"><a href="#c-版更多语法的例子" class="header-anchor">#</a> C#版更多语法的例子</h1> <div class="language- extra-class"><pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using static UVMCoreLib.UVMCoreFuncs;
using UVMCoreLib;

namespace Demo1
{
public class Storage
{
    public string Name { get; set; }
    public int Age { get; set; }
    public string Country; // field test
    public bool IsMale { get; set; }
}

public class HelloContract
{
    public void SayHello(string arg)
    {
        print(&quot;hello, this is hello contract api SayHello with arg &quot; + tostring(arg));
    }
}

public class MyEventEmitteer : IUVMEventEmitter
{
    public static void EmitHello(string eventArg)
    {
        Console.WriteLine(&quot;event Hello emited, arg is &quot; + eventArg);
    }
    public static void EmitHello2(string eventArg)
    {
        Console.WriteLine(&quot;event Hello2 emited, arg is &quot; + eventArg);
    }
}

public class MyContract : UVMContract&lt;Storage&gt;
{
    public MyContract() : base(new Storage())
    {
    }
    public override void init()
    {
        print(&quot;contract initing&quot;);
        this.storage.Age = 100;
        this.storage.Country = &quot;China&quot;;
        this.storage.Name = &quot;C#&quot;;   
        pprint(this);
        print(&quot;this is contract init api end&quot;);
    }
    public string GetAge(string arg)
    {
        print(&quot;this is contract getAge api&quot;);
        return &quot;&quot; + this.storage.Age;
    }
    public string OfflineGetAge(string arg)
    {
        print(&quot;this is contract OfflineGetAge api&quot;);
        print(&quot;age is &quot; + this.storage.Age);
        return &quot;&quot; + this.storage.Age;
    }
    public void TestHello(string arg)
    {
       print(&quot;this is contract hello api with argument &quot; + arg);
    }
}

public class ExampleLibClass
{
    
    public int SayHi()
    {
        Console.WriteLine(&quot;hello,\tCecil&quot;);
        var a = 5;
        var b = 100;
        var sum = 3;       

        if (b &gt; 50)
        {
            Console.WriteLine(&quot;hello, this is if condition=true branch&quot;);
        }
        else if (b &gt; 25)
        {
            Console.WriteLine(&quot;hello, this is if elseif condition branch&quot;);
        }
        else
        {
            Console.WriteLine(&quot;hello, this is if condition=else branch&quot;);
        }
        var d = &quot;a &quot; + sum;
        Console.WriteLine(b);
        Console.WriteLine(&quot;hello world&quot;);
        Console.WriteLine(&quot;sum is &quot; + 123);
        Console.WriteLine(&quot;sum is &quot; + d);
        Console.WriteLine(a + b);

        print(&quot;&quot; + 123);

        return a + b + 1234;
    }

    public void TestIf()
    {
        Console.WriteLine(&quot;this is test if function&quot;);
        var b = 30;
        if (b &gt; 50)
        {
            Console.WriteLine(&quot;hello, this is if condition=true branch&quot;);
        }
        else if (b &gt; 25)
        {
            Console.WriteLine(&quot;hello, this is if elseif condition branch&quot;);
        }
        else
        {
            Console.WriteLine(&quot;hello, this is if condition=else branch&quot;);
        }
        }            

        public void TestFor()
        {
        int sum = 0;
        for (var i = 0; i &lt; 10; ++i)
        {
            sum += i;
            Console.WriteLine(&quot;for loop in&quot;);
        }
        Console.WriteLine(&quot;test for sum is &quot; + sum); // sum=45
    }

    public void TestWhile()
    {
        int sum = 0;
        int i = 0;
        while (i &lt; 10)
        {
            sum += i;
            Console.WriteLine(&quot;while loop in&quot;);
            i++;
        }
        Console.WriteLine(&quot;test while loop sum is &quot; + sum); // sum=45
        }

        public void TestCompare()
        {
        var a = 5;
        Console.WriteLine(&quot;5==5 is &quot; + ((a == 5) ? &quot;true&quot; : &quot;false&quot;));
        Console.WriteLine(&quot;4&lt;5 is &quot; + ((4 &lt; a) ? &quot;true&quot; : &quot;false&quot;));

        if (a == 5)
        {
            Console.WriteLine(&quot;a==5&quot;);
        }
        else
        {
            Console.WriteLine(&quot;a!=5&quot;);
        }
    }

    public void TestContinue()
    {
        Console.WriteLine(&quot;test continue case&quot;);
        int sum = 0;
        for (var i = 0; i &lt; 10; ++i)
        {
            if (i == 5)
            {
            Console.WriteLine(&quot;continue when i=&quot; + i);
            continue;
            }
            sum += i;
            Console.WriteLine(&quot;for loop in&quot;);
        }
        Console.WriteLine(&quot;test for sum with continue is &quot; + sum); // sum=40
    }

    public void TestBreak()
    {
        Console.WriteLine(&quot;test break case&quot;);
        int sum = 0;
        for (var i = 0; i &lt; 10; ++i)
        {
            if (i == 5)
            {
            Console.WriteLine(&quot;break when i=&quot; + i);
            break;
            }
            sum += i;
            Console.WriteLine(&quot;for loop in&quot;);
        }
        Console.WriteLine(&quot;test for sum with break is &quot; + sum); // sum = 10
        }

        public int TestFuncArg(int a, int b, String name, bool c)
        {
        Console.WriteLine(a);
        Console.WriteLine(b);
        Console.WriteLine(&quot;name=&quot; + name); // name=C#
        Console.WriteLine(&quot;c=&quot; + c); // c=true  
        Console.WriteLine(&quot;hi &quot; + c); // hi true
        Console.WriteLine(&quot;args a + b = &quot; + (a + b)); // a+b=11 when a = 5, b = 6
        a = 10;
        b = 20;
        return a + b; // should be 30
        }

        public void TestMultiConcat()
        {
        int a = 1;
        // 不支持超过2个字符串的字符串连接，因为.net数组是0-based，uvm数组是1-based
        // Console.WriteLine(&quot;TestMultiConcat &quot; + a + &quot; and &quot; + a);
    }

    public void TestArithmeticOperators()
    {
        var a = 8;
        var b = 3;
        var c = a - b;
        Console.WriteLine(&quot;8-3=&quot; + c); // 8-3=5
        Console.WriteLine(&quot;8*3=&quot; + (a * b)); // 8*3=24
        Console.WriteLine(&quot;8/3=&quot; + (a / b)); // 8/3=2, 整数除法
        Console.WriteLine(&quot;8 div 3=&quot; + div(a, b)); // 8 div 3=2.666, 浮点除法
        Console.WriteLine(&quot;8 idiv 3=&quot; + idiv(a, b)); // 8 idiv 3=2 整数除法
        Console.WriteLine(&quot;7%3=&quot; + (7 % b)); // 7%3=1
        // 因为0在uvm中是布尔真值，所以暂时用一个单独的函数库做布尔运算
        Console.WriteLine(&quot;true &amp;&amp; false=&quot; + and(true, false)); // true &amp;&amp; false = false
        Console.WriteLine(&quot;true || false=&quot; + or(true, false)); // true || false = true
        Console.WriteLine(&quot;9&amp;3=&quot; + (9 &amp; b)); // 9&amp;3=1
        Console.WriteLine(&quot;9|3=&quot; + (9 | b)); // 9|3=11
        Console.WriteLine(&quot;9^3=&quot; + (9 ^ b)); // 9^3=10
        Console.WriteLine(&quot;8&gt;&gt;3=&quot; + (a &gt;&gt; b)); // 8&gt;&gt;3=1
        Console.WriteLine(&quot;8&lt;&lt;3=&quot; + (a &lt;&lt; 3)); // 8&lt;&lt;3=64     
        var t = true;
        print(&quot;-8=&quot; + (-a)); // -8=-8        
        print(&quot;-8=&quot; + neg(a)); // -8=-8
        print(&quot;!true=&quot; + (!t)); // !true=0   这里.net字节码把布尔当0/1 int处理  
        print(&quot;!true=&quot; + not(t)); // !true=false        
    }

    public void TestPlainObject()
    {
        var storage = new Storage();
        storage.Name = &quot;C#&quot;;
        storage.Age = 100;
        storage.IsMale = true;
        storage.Country = &quot;China&quot;;
        Console.WriteLine(&quot;storage name is &quot; + storage.Name);
        Console.WriteLine(&quot;storage age is &quot; + storage.Age);
        Console.WriteLine(&quot;storage isMale is &quot; + storage.IsMale);
        print(&quot;storage country is &quot; + storage.Country);
        pprint(storage);
        pprint(null);
    }

    public void TestArray()
    {
        var array1 = UVMArray&lt;int?&gt;.Create();
        array1.Add(1);
        array1.Add(2);
        array1.Add(3);
        array1.Add(4);
        pprint(array1);
        print(&quot;array 1 size is &quot; + array1.Count()); // 4      
        array1.Set(4, 2); 
        print(&quot;array[4] is &quot; + array1.Get(4)); // 2  
        array1.Pop();
        print(&quot;array 1 after changed size is &quot; + array1.Count()); // 3
        print(&quot;array[3] is &quot; + array1.Get(3)); // 3      
        for (int i = 1; i &lt;= array1.Count(); ++i)
        {
            var item = array1.Get(i);
            print(&quot;index: &quot; + i);
            print(&quot;value: &quot; + item);
        }
    }

    public void TestMap()
    {
        var map1 = UVMMap&lt;string&gt;.Create();
        map1.Set(&quot;name&quot;, &quot;C#&quot;);
        map1.Set(&quot;country&quot;, &quot;China&quot;);
        Console.WriteLine(&quot;map1's name is &quot; + map1.Get(&quot;name&quot;));
        Console.WriteLine(&quot;map1's country is &quot; + map1.Get(&quot;country&quot;));

        // 遍历map的demo
        var map1PairsIter = map1.Pairs();
        pprint(map1PairsIter);
        var keyValuePair = map1PairsIter(map1, null);
        pprint(keyValuePair);
        print(keyValuePair.Key);
        print(keyValuePair.Value);
        while (keyValuePair.Key != null)
        {
            Console.WriteLine(&quot;key: &quot; + tostring(keyValuePair.Key));
            Console.WriteLine(&quot;value: &quot; + tostring(keyValuePair.Value));

            if (keyValuePair.Key == &quot;name&quot;)
            {
            print(&quot;found key==name pair&quot;);
            }
            keyValuePair = map1PairsIter(map1, keyValuePair.Key);
        }

    }

    public void TestEmitEvent()
    {
        MyEventEmitteer.EmitHello(&quot;hello&quot;);
        var a = 3;
        var b = 4;
        MyEventEmitteer.EmitHello2(&quot;&quot; + (a + b)); 
    }

    public void TestModules()
    {  
        // 引用string模块，UVMStringModule类型是返回的模块对象的类型，必须用合适的类型来引用合适的模块
        var strModule = importModule&lt;UVMStringModule&gt;(&quot;string&quot;);
        pprint(&quot;string module: &quot; + tojsonstring(strModule));

        // 可以调用string模块的函数来获取字符串长度，也可以用C#的字符串类型的内置Length属性来获取字符串长度
        var helloLength = &quot;hello&quot;.Length;
        var helloLength2 = strModule.Len(&quot;hello&quot;);
        print(&quot;hello string length is: &quot; + helloLength);
        print(&quot;hello string length2 is: &quot; + helloLength2);

        var tableModule = importModule&lt;UVMTableModule&gt;(&quot;table&quot;);
        var table1 = UVMArray&lt;string&gt;.Create();
        table1.Add(&quot;a&quot;);
        tableModule.Append(table1, &quot;b&quot;);
        var table1Count = tableModule.Length(table1);
        print(&quot;table1 size is: &quot; + table1Count);

        var mathModule = importModule&lt;UVMMathModule&gt;(&quot;math&quot;);
        var floor1 = mathModule.Floor(3.3);  
        print(&quot;floor(3.3) = &quot; + floor1);

        var abs1 = mathModule.Abs(-4);
        print(&quot;abs(-4) = &quot; + abs1);

        var pi = mathModule.pi;
        print(&quot;pi = &quot; + pi);

        var timeModule = importModule&lt;UVMTimeModule&gt;(&quot;time&quot;);            
        print(&quot;date: &quot; + timeModule.Tostr(1494301754));

        var jsonModule = importModule&lt;UVMJsonModule&gt;(&quot;json&quot;);
        print(&quot;dumps of json module is: &quot; + jsonModule.Dumps(jsonModule));

        var typeOfNumber = Type(123);
        print(&quot;type(123) = &quot; + typeOfNumber);

        var array1 = UVMArray&lt;string&gt;.Create();
        array1.Add(&quot;a&quot;);
        array1.Add(&quot;b&quot;);
        print(&quot;rawlen(['a', 'b'])=&quot; + rawlen(array1));

        print(&quot;caller_address = &quot; + tostring(caller_address())); // 非合约中会返回nil

        var array1Iter = array1.Ipairs();
        var array1keyValuePair = array1Iter(array1, 0);
        while(array1keyValuePair.Key != null)
        {                             
            print(&quot;key: &quot; + array1keyValuePair.Key);
            print(&quot;value: &quot; + array1keyValuePair.Value);
            array1keyValuePair = array1Iter(array1, array1keyValuePair.Key);
        }                                            
    }

    public void TestImportContract()
    {
        var helloContract = importContract&lt;HelloContract&gt;(&quot;hello&quot;);
        helloContract.SayHello(&quot;C#&quot;);
    }
    
    /**
    * 这是程序入口，必需，且必须是非static方法.如果是要定义合约，需要返回类型是一个合约类型
    */
    public MyContract Main()
    {
        print(&quot;start of demo C# contract \r\n another line&quot;);
        
        var result = SayHi();
        Console.WriteLine(&quot;SayHi result is &quot; + result);
        TestIf();
        TestFor();
        TestWhile();
        TestContinue();
        TestCompare();
        TestBreak();
        var testFuncArgResult = TestFuncArg(5, 6, &quot;C#&quot;, true);
        Console.WriteLine(&quot;testFuncArg result is &quot; + testFuncArgResult);
        TestArithmeticOperators();
        TestPlainObject();
        TestArray();
        TestMap();
        TestEmitEvent();
        TestModules();
        
        // TestImportContract();

        var contract = new MyContract();

        contract.storage = new Storage(); 
        contract.init();

        pprint(contract); 
        
        var offlineGetAgeRet = contract.OfflineGetAge(&quot;&quot;);
        print(&quot;OfflineGetAge ret is &quot; + offlineGetAgeRet);    
        
        print(&quot;end main&quot;);
        return contract;
    }
}
}
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.67072d70.js" defer></script><script src="/assets/js/2.9eb1a6e4.js" defer></script><script src="/assets/js/14.74e35c2b.js" defer></script>
  </body>
</html>
